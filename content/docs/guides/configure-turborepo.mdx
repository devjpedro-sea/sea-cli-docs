---
title: Configurar Turborepo
description: Configure Turborepo para otimizar builds em monorepos com cache inteligente
---

# Configurar Turborepo

Configure Turborepo no seu workspace para builds paralelos e cache inteligente de monorepos.

## VisÃ£o Geral

Turborepo Ã© uma ferramenta de build system que otimiza monorepos atravÃ©s de:

- **Builds paralelos**: MÃºltiplos projetos ao mesmo tempo
- **Cache inteligente**: Nunca rebuilde o que nÃ£o mudou
- **Pipelines**: Orquestre tarefas com dependÃªncias
- **Remote Caching**: Compartilhe cache entre desenvolvedores

<Callout type="info">
**Ganho de performance:** Reduza tempo de build em atÃ© 85% com cache.
</Callout>

## Quando usar?

Use Turborepo quando vocÃª tem:

- MÃºltiplos client extensions
- Monorepo com vÃ¡rios projetos
- Builds demorados
- Equipe compartilhando cÃ³digo
- CI/CD complexo

## PrÃ©-requisitos

- Workspace com pasta `client-extensions/`
- MÃºltiplos client extensions (mÃ­nimo 2)
- SEA CLI instalado
- Node.js 16.0.0+

## Como Configurar

<Steps>

### Entrar na pasta client-extensions

```bash
cd seu-workspace/client-extensions
```

### Executar o comando

Modo interativo:
```bash
sea-cli init
# Escolher: Configurar Turborepo
```

Ou diretamente:
```bash
sea-cli create-turbo
```

### Confirmar configuraÃ§Ã£o

```
âœ“ Encontrados 3 client extensions:
  - custom-element
  - theme-css
  - global-js

? Configurar Turborepo para todos? (Y/n)
```

### Aguardar instalaÃ§Ã£o

O SEA CLI irÃ¡:
1. Instalar Turborepo
2. Criar `turbo.json`
3. Configurar workspace
4. Atualizar package.json
5. Criar scripts de build

</Steps>

## Estrutura ApÃ³s ConfiguraÃ§Ã£o

```
client-extensions/
â”œâ”€â”€ custom-element/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ theme-css/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ global-js/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ package.json              # Root package.json (NOVO)
â”œâ”€â”€ turbo.json               # ConfiguraÃ§Ã£o Turborepo (NOVO)
â”œâ”€â”€ .gitignore               # Atualizado
â””â”€â”€ README.md                # Atualizado
```

## ConfiguraÃ§Ã£o turbo.json

### Arquivo Gerado

```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["build/**", "dist/**"]
    },
    "lint": {
      "cache": true
    },
    "test": {
      "cache": true,
      "dependsOn": ["build"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

### ExplicaÃ§Ã£o

- **pipeline**: Define tarefas e suas dependÃªncias
- **dependsOn**: Ordem de execuÃ§Ã£o
- **outputs**: Arquivos que devem ser cacheados
- **cache**: Se deve usar cache
- **persistent**: Para processos longos (dev server)

## Package.json Root

### Arquivo Criado

```json
{
  "name": "client-extensions",
  "private": true,
  "workspaces": [
    "custom-element",
    "theme-css",
    "global-js"
  ],
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "clean": "turbo run clean"
  },
  "devDependencies": {
    "turbo": "^1.10.0"
  }
}
```

## Usando Turborepo

### Build Todos os Projetos

```bash
cd client-extensions
npm run build
```

Output:
```
â€¢ Packages in scope: custom-element, theme-css, global-js
â€¢ Running build in 3 packages
â€¢ Remote caching disabled

custom-element:build: cache miss, executing
theme-css:build: cache miss, executing
global-js:build: cache miss, executing

 Tasks:    3 successful, 3 total
Cached:    0 cached, 3 total
  Time:    5.2s
```

### Build com Cache

Segunda execuÃ§Ã£o (sem mudanÃ§as):

```bash
npm run build
```

Output:
```
â€¢ Packages in scope: custom-element, theme-css, global-js
â€¢ Running build in 3 packages
â€¢ Remote caching disabled

custom-element:build: cache hit, replaying output
theme-css:build: cache hit, replaying output
global-js:build: cache hit, replaying output

 Tasks:    3 successful, 3 total
Cached:    3 cached, 3 total
  Time:    0.8s >>> FULL TURBO
```

### Lint Tudo

```bash
npm run lint
```

Executa lint em todos os projetos em paralelo.

### Testes

```bash
npm run test
```

Executa testes de todos os projetos.

### Desenvolvimento

```bash
npm run dev
```

Inicia dev servers de todos os projetos.

## Comandos EspecÃ­ficos

### Build Apenas Um Projeto

```bash
turbo run build --filter=custom-element
```

### Build com DependÃªncias

```bash
turbo run build --filter=custom-element...
```

Builda `custom-element` e suas dependÃªncias.

### Build Excluindo Projeto

```bash
turbo run build --filter=!theme-css
```

### Limpar Cache

```bash
turbo run clean
```

## Pipeline AvanÃ§ado

### DependÃªncias entre Projetos

Se `custom-element` depende de `shared-utils`:

```json
{
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["build/**"]
    }
  }
}
```

O `^` indica "dependÃªncias upstream".

### Tasks em SequÃªncia

```json
{
  "pipeline": {
    "test": {
      "dependsOn": ["build", "lint"]
    }
  }
}
```

Testes sÃ³ rodam apÃ³s build e lint.

### Environment Variables

```json
{
  "pipeline": {
    "build": {
      "env": ["NODE_ENV", "API_URL"],
      "outputs": ["build/**"]
    }
  }
}
```

Cache invalida se essas variÃ¡veis mudarem.

## Remote Caching

### Configurar Vercel

```bash
npx turbo login
npx turbo link
```

### Configurar Remote Cache

```json
{
  "remoteCache": {
    "signature": true
  }
}
```

### Build com Remote Cache

```bash
turbo run build
```

Cache compartilhado entre toda a equipe e CI/CD.

## Workspaces

### Adicionar Novo Workspace

Edite `package.json`:

```json
{
  "workspaces": [
    "custom-element",
    "theme-css",
    "global-js",
    "new-extension"  // NOVO
  ]
}
```

### Instalar em Workspace EspecÃ­fico

```bash
npm install react --workspace=custom-element
```

### Rodar Script em Workspace

```bash
npm run build --workspace=custom-element
```

## OtimizaÃ§Ãµes

### Paralelismo

Por padrÃ£o, Turborepo usa todos os CPUs disponÃ­veis:

```bash
# Limitar a 2 CPUs
turbo run build --concurrency=2
```

### Only Changed

Build apenas o que mudou:

```bash
turbo run build --filter=[HEAD^1]
```

Ãštil em CI/CD.

### Dry Run

Ver o que seria executado:

```bash
turbo run build --dry-run
```

## IntegraÃ§Ã£o CI/CD

### GitHub Actions

```yaml
name: Build
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          
      - name: Install dependencies
        run: npm install
        
      - name: Build
        run: npx turbo run build
        
      - name: Test
        run: npx turbo run test
```

### GitLab CI

```yaml
build:
  stage: build
  script:
    - npm install
    - npx turbo run build
  cache:
    paths:
      - node_modules/
      - .turbo/
```

### Cache no CI

```yaml
- name: Cache Turbo
  uses: actions/cache@v3
  with:
    path: .turbo
    key: ${{ runner.os }}-turbo-${{ github.sha }}
    restore-keys: |
      ${{ runner.os }}-turbo-
```

## Debugging

### Ver Grafo de DependÃªncias

```bash
turbo run build --graph
```

Gera arquivo DOT do grafo.

### Ver Output Detalhado

```bash
turbo run build --output-logs=new-only
```

OpÃ§Ãµes:
- `full`: Mostrar tudo
- `hash-only`: Apenas hashes
- `new-only`: Apenas novos builds
- `none`: Silencioso

### Ver Timing

```bash
turbo run build --profile=profile.json
```

Analise performance no Chrome DevTools.

## Troubleshooting

### Cache nÃ£o funciona

**Problema:** Sempre rebuilda tudo

**SoluÃ§Ã£o:**
```bash
# Limpar cache
rm -rf .turbo

# Verificar outputs
cat turbo.json

# Verificar gitignore
echo ".turbo" >> .gitignore
```

### Build muito lento

**Problema:** Turbo nÃ£o paralleliza

**SoluÃ§Ã£o:**
```bash
# Verificar dependÃªncias circulares
turbo run build --graph

# Aumentar paralelismo
turbo run build --concurrency=10
```

### Workspace nÃ£o encontrado

**Problema:** "Package not found"

**SoluÃ§Ã£o:**
```bash
# Verificar workspaces
cat package.json

# Reinstalar
rm -rf node_modules
npm install
```

## Boas PrÃ¡ticas

<Callout type="tip">
### RecomendaÃ§Ãµes
- **Commitar .turbo/** ao .gitignore
- **Usar Remote Caching** em equipes
- **Configurar outputs** corretamente
- **Documentar pipeline** no README
- **Monitorar performance** com --profile
</Callout>

## ComparaÃ§Ã£o de Performance

### Sem Turborepo

```
Build sequencial:
- custom-element: 15s
- theme-css: 10s
- global-js: 8s
Total: 33s
```

### Com Turborepo (primeira vez)

```
Build paralelo:
- custom-element: 15s
- theme-css: 10s  } Em paralelo
- global-js: 8s   }
Total: 15s (build mais lento)
```

### Com Turborepo (com cache)

```
Build com cache:
- custom-element: 0.5s (cache hit)
- theme-css: 0.5s (cache hit)
- global-js: 0.5s (cache hit)
Total: 0.5s ðŸš€
```

## Monorepo Completo

### Estrutura Ideal

```
workspace/
â”œâ”€â”€ client-extensions/
â”‚   â”œâ”€â”€ package.json      # Root com workspaces
â”‚   â”œâ”€â”€ turbo.json        # Pipeline config
â”‚   â”œâ”€â”€ extension-1/
â”‚   â”œâ”€â”€ extension-2/
â”‚   â””â”€â”€ extension-3/
â””â”€â”€ packages/             # CÃ³digo compartilhado
    â”œâ”€â”€ shared-ui/
    â”œâ”€â”€ shared-utils/
    â””â”€â”€ shared-types/
```

### Compartilhar CÃ³digo

```json
// extension-1/package.json
{
  "dependencies": {
    "shared-ui": "*",
    "shared-utils": "*"
  }
}
```

Turborepo gerencia dependÃªncias internas automaticamente.

## MigraÃ§Ã£o para Turborepo

### De Scripts Manuais

Antes:
```bash
cd extension-1 && npm run build
cd extension-2 && npm run build
cd extension-3 && npm run build
```

Depois:
```bash
turbo run build
```

### Incremental

Pode migrar gradualmente:
1. Adicionar Turborepo
2. Manter scripts antigos
3. Migrar projeto por projeto
4. Remover scripts antigos

## Recursos Relacionados

- [Criar Client Extension](/docs/guides/create-client-extension)
- [Criar MÃ³dulo](/docs/guides/create-module)
- [Turborepo Docs](https://turbo.build/)
- [Workflow de Desenvolvimento](/docs/workflows/development-workflow)

---

**Turborepo configurado!** Aproveite builds ultra-rÃ¡pidos com cache inteligente.
